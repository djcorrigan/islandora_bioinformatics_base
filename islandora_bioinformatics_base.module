<?php

/**
  * @file
  * Hooks and callbacks for the module.
  */

/**
  * Implements hook_islandora_required_objects().
  */

  function islandora_bioinformatics_base_islandora_required_objects(IslandoraTuque $connection) {
    $module_path = drupal_get_path('module', 'islandora_bioinformatics_base');

    // Project Content Model
    $project_cm = $connection->repository->constructObject('islandora:project_cmodel');
    $project_cm->owner = 'fedoraAdmin';
    $project_cm->label = 'Islandora Bioinformatics Project Content Model';
    $project_cm->models = 'fedora-system:ContentModel-3.0';

    $datastream = $project_cm->constructDatastream('DS-COMPOSITE-MODEL', 'X');
    $datastream->label = 'Project content model';
    $datastream->mimetype= 'text/xml';
    $datastream->setContentFromFile("$module_path/xml/content_models/Project_ds_composite_model.xml", FALSE);
    $project_cm->ingestDatastream($datastream);

    // Person Content Model
    $person_cm = $connection->repository->constructObject('islandora:person_cmodel');
    $person_cm->owner = 'fedoraAdmin';
    $person_cm->label = 'Islandora Bioinformatics Person Content Model';
    $person_cm->models = 'fedora-system:ContentModel-3.0';

    $datastream = $person_cm->constructDatastream('DS-COMPOSITE-MODEL', 'X');
    $datastream->label = 'Person content model';
    $datastream->mimetype= 'text/xml';
    $datastream->setContentFromFile("$module_path/xml/content_models/Person_ds_composite_model.xml", FALSE);
    $person_cm->ingestDatastream($datastream);

    // TN Datastream for Person -- To allow upload of portrait image
    $datastream = $person_cm->constructDatastream('TN', 'M');
    $datastream->label = 'Thumbnail';
    $datastream->mimetype = 'image/png';
    $datastream->setContentFromFile("$module_path/images/folder.png", FALSE);
    $person_cm->ingestDatastream($datastream);
	
    // LabObject Content Model
    $labObject_cm = $connection->repository->constructObject('islandora:lab_object_cmodel');
    $labObject_cm->owner = 'fedoraAdmin';
    $labObject_cm->label = 'Islandora Bioinformatics LabObject Content Model';
    $labObject_cm->models = 'fedora-system:ContentModel-3.0';

    $datastream = $labObject_cm->constructDatastream('DS-COMPOSITE-MODEL', 'X');
    $datastream->label = 'LabObject content model';
    $datastream->mimetype= 'text/xml';
    $datastream->setContentFromFile("$module_path/xml/content_models/LabObject_ds_composite_model.xml", FALSE);
    $labObject_cm->ingestDatastream($datastream);

    // LabActivity Content Model
    $labActivity_cm = $connection->repository->constructObject('islandora:lab_activity_cmodel');
    $labActivity_cm->owner = 'fedoraAdmin';
    $labActivity_cm->label = 'Islandora Bioinformatics LabActivity Content Model';
    $labActivity_cm->models = 'fedora-system:ContentModel-3.0';

    $datastream = $labActivity_cm->constructDatastream('DS-COMPOSITE-MODEL', 'X');
    $datastream->label = 'LabActivity content model';
    $datastream->mimetype= 'text/xml';
    $datastream->setContentFromFile("$module_path/xml/content_models/LabActivity_ds_composite_model.xml", FALSE);
    $labActivity_cm->ingestDatastream($datastream);

    return array(
      'islandora_bioinformatics_base' => array(
          'title' => 'Bioinformatics Base',
          'objects' => array(
              $project_cm,
              $person_cm,
              $labObject_cm,
              $labActivity_cm,
          ),
        ),
      );
    }

  function islandora_bioinformatics_base_islandora_xml_form_builder_forms() {
    $module_path = drupal_get_path('module', 'islandora_bioinformatics_base');
    return array(
      'Person MADS form' => array(
        'form_file' => "$module_path/xml/forms/islandora_bioinformatics_person_form_mads.xml",
      ),
      'Project MADS form' => array(
        'form_file' => "$module_path/xml/forms/islandora_bioinformatics_project_form_mads.xml",
      ),
    );
  }

  function islandora_bioinformatics_base_islandora_xml_form_builder_form_associations() {
    return array(
      'islandora_bioinformatics_person_form_mads' => array(
        'content_model' => 'islandora:person_cmodel',
        'form_name' => 'Person MADS form',
        'dsid' => 'MADS',
        'title_field' => array('authority','titleInfo', 'title'),
        'transform' => '',
        'template' => FALSE,
      ),
      'islandora_bioinformatics_project_mads_form' => array(
        'content_model' => 'islandora:project_cmodel',
        'form_name' => 'Project MADS form',
        'dsid' => 'MADS',
        'transform' => '',
        'title_field' => array('authority','titleInfo', 'title'),
        'template' => FALSE,
      ),  
    );
  }
  
 /**
 * Implements hook_islandora_ingest_steps() for the person_cmodel.
 */
function islandora_bioinformatics_base_islandora_person_cmodel_islandora_ingest_steps(array $configuration) {

  return array(
    'islandora_bioinformatics_base' => array(
      'weight' => 10,
      'type' => 'form',
      'form_id' => 'islandora_bioinformatics_base_person_image_upload_form',
      'module' => 'islandora_bioinformatics_base',
      'file' => 'includes/person_image_upload.form.inc',
    ),
  );
}

 /**
 * Implements hook_islandora_ingest_steps() for the project_cmodel.
 */
function islandora_bioinformatics_base_islandora_project_cmodel_islandora_ingest_steps(array $configuration) {

  return array(
  /*
    'islandora_bioinformatics_base' => array(
      'weight' => 10,
      'type' => 'form',
      'form_id' => 'islandora_bioinformatics_base_image_upload_form',
      'module' => 'islandora_bioinformatics_base',
      'file' => 'includes/image_upload.form.inc',
    ),
  */
  );
}
